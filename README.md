# 奖励分配系统

本项目提供一个使用 **PHP + MySQL** 实现的奖励分配管理系统，满足以下业务规则：

- 管理员可以维护用户、项目的基础信息。
- 用户与项目支持 Excel 批量导入，可选择仅新增或清空后导入。
- 项目负责人登录后管理自己负责的项目，将项目总金额按规则分配给团队成员。
- 管理员可按项目名称、类别、层级查看和导出分配明细。
- 管理员可一目了然地查看各项目分配状态，区分已完成与待分配。
- 所有成员、负责人均显示工号信息，并支持按姓名/工号模糊检索，避免同名冲突。


## 目录结构

```
├── admin                 # 管理员相关页面
├── dashboard.php         # 登录后的控制台
├── database
│   ├── schema.sql        # 数据库结构定义
│   └── seed.sql          # 示例数据
├── includes              # 公共 PHP 函数
├── index.php             # 登录页
├── projects              # 项目负责人相关页面
├── styles.css            # 全局样式
└── README.md
```

## 环境要求

- PHP 8.1 及以上（需启用 `PDO`、`pdo_mysql`、`ZipArchive` 扩展）
- MySQL 5.7+ / MariaDB 10+
- Composer（可选，用于安装额外依赖）

## 部署步骤

1. 创建数据库并执行初始化脚本：

   ```bash
   mysql -u root -p -e "CREATE DATABASE reward_app DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
   mysql -u root -p reward_app < database/schema.sql
   mysql -u root -p reward_app < database/seed.sql
   ```

2. 根据实际情况设置数据库连接环境变量（或直接修改 `includes/db.php` 中的默认值）：

   ```bash
   export DB_HOST=127.0.0.1
   export DB_PORT=3306
   export DB_DATABASE=reward_app
   export DB_USERNAME=reward_user
   export DB_PASSWORD=your_password
   ```

3. 将整个项目目录（例如部署在 `mydomain.com/work`）映射为可访问目录，或在项目根目录使用 PHP 内置服务器进行调试：

   ```bash
   php -S 0.0.0.0:8000
   ```

4. 使用浏览器访问对应路径，例如 `http://localhost:8000/index.php` 或 `http://localhost:8000/work/`。

## 默认账户

示例数据中包含以下账号（初始密码为出生日期的 8 位数字）：

| 用户编号 | 姓名       | 角色     | 初始密码 |
| -------- | ---------- | -------- | -------- |
| admin01  | 系统管理员 | 管理员   | 19800101 |
| u1001    | 张三       | 普通用户 | 19900505 |
| u1002    | 李四       | 中层     | 19850210 |
| u1003    | 王五       | 普通用户 | 19920820 |
| u1004    | 赵六       | 中层     | 19880912 |
| u1005    | 孙七       | 普通用户 | 19951130 |

登录后可以在“控制面板”根据角色进入不同功能：

- **管理员**：维护用户、项目，并查看/导出分配情况。
- **项目负责人**：在“我负责的项目”中维护成员和分配金额。
- **团队成员**：在“我参与的项目”中查看个人获得的分配金额。

## Excel 批量导入模板

### 用户导入

- Excel 表头需依次包含：`姓名`、`工号`、`角色`、`出生日期`。
- 出生日期支持 `YYYY-MM-DD`、`YYYYMMDD` 或 Excel 日期单元格，导入后会自动转为 `YYYY-MM-DD`。
- “仅新增”模式会检测现有工号，若重复会终止导入；“清空后导入”模式会保留所有管理员账号，其余用户及关联的分配、项目信息会清理后再插入新数据。
- 导入完成后，所有新用户的默认登录密码会重置为出生日期对应的 8 位数字。

### 项目导入

- Excel 表头需包含：`项目名称`、`项目类别`、`项目层级`、`项目总金额`、`项目负责人工号`。
- 项目总金额支持 Excel 数值或带千分位的文本，会自动校验大于 0 并保留两位小数。
- 负责人工号必须已存在于用户列表中，否则导入会失败；如果负责人存在同名，通过工号即可精准匹配。
- “仅新增”模式会阻止与现有项目同名的记录，“清空后导入”模式会清除所有项目及其分配记录后再写入。

> **提示**：系统允许姓名重复，但工号必须全局唯一，请在整理模板时重点核对。

## 分配规则校验

在项目负责人填写分配金额时，系统会自动校验以下规则：

1. 项目总金额必须被全部分配，允许小数点后 2 位。
2. 项目成员最多 15 人，且不能包含高层角色。
3. 所有中层成员的金额合计不超过项目总金额的 30%。
4. 单个中层成员的金额不超过项目总金额的 10%。

若违反规则，系统会提示错误并阻止保存。

## 项目负责人填报体验

- 候选成员下拉框支持输入姓名或工号关键字模糊搜索，便于快速定位人员。
- 候选列表及分配表均显示成员工号，可轻松区分同名用户。
- 页面顶部会同时展示项目负责人姓名与工号，方便核对。

## 数据导出

管理员在“分配情况”页面可按条件筛选，并通过右上角的“导出 CSV”按钮导出当前筛选结果。导出的文件包含负责人及成员的工号，方便后续复核。

此外，“个人所得统计”页面会按人员聚合所有分配金额，支持按姓名/工号、角色筛选并导出 CSV，便于个税申报或财务核算。

## 后续扩展建议

- 接入公司统一账号体系实现单点登录。
- 为管理员操作添加审计日志。
- 引入前端框架或组件库美化页面。
- 将配置项迁移到 `.env` 文件并使用配置管理工具。

